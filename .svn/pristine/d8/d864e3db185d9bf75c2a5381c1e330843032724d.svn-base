<?php
	echo $this->Html->script(array('jquery-ui.custom')); 
	echo $this->Html->css(array('jquery-ui.custom')); 
 ?>
 
	<!-- MId Section -->
	<section class="body-content-bg ptb25 row">
		<div class="page-mid">
			<div class="body-content-mn row mt10">
				<div class="row">
					<div class="register-columns">
						<?php echo $this->Form->create('Coach',array('type'=>'file','id'=>'InviteCoachForm','class'=>'border-btm')); ?>
						<div class="column">
							
							<div class="header">
								<h3>ADD COACH</h3>										  
								
							</div>
							<?php 
								echo $this->Session->flash('success');
								echo $this->Session->flash('error');
								echo $this->Session->flash();
							?>
							<div class="column-body graybg create-event" style="padding-bottom:0px;">							

								<div class="form-container no-lmr">								
									
                                    <div class="left-side-box invitation_form">
										<input type="hidden" name="data[Coach][selected_coach]" id="selected_coach" />
										<ul class="two-columns">
											<li>
												<label>Select Coach from GameOn: </label>	
												<input type="text" name="data[Coach][name]" id="coach_options" placeholder="Start typing name here" />									
											</li>	
											
											<li>
												<div class="blue">
													<button onclick="return invite_user();">Invite</button>
												</div>
											</li>										
										</ul>																		
										
                                    </div> <!--left side box ends -->                                                               
									
									<div class="clear"></div>
																		
                                    <div class="container">
									  <div class="leftColumns custom_invitation_form">	
										<ul class="two-columns">
											<li>
												<?php echo $this->Form->label('Coach.first_name','First Name'); 
													echo $this->Form->input('Coach.first_name',array('type'=>'text', 'class'=>'required','label'=>false,'div'=>false)); 
												?>											
											</li>											
											<li>
												<?php echo $this->Form->label('Coach.last_name','Last Name'); 
													echo $this->Form->input('Coach.last_name',array('type'=>'text', 'class'=>'required','label'=>false,'div'=>false)); 
												?>											
											</li>											
										 </ul>									 
										 
										 <ul class="two-columns">
											<li>
												<?php echo $this->Form->label('Coach.email','Email'); 
													echo $this->Form->input('Coach.email',array('type'=>'text', 'class'=>'required email','label'=>false,'div'=>false)); 
												?>											
											</li>	
											<li>
												<?php echo $this->Form->label('Coach.profile_link','Profile Link'); 
													echo $this->Form->input('Coach.profile_link',array('type'=>'text', 'class'=>'required','label'=>false,'div'=>false)); 
												?>	
											</li>																			
										 </ul>
										 
										 <ul class="two-columns">																						
											<li>
												<?php echo $this->Form->label('Coach.photo','Photo'); ?>												
													<div class="inputbrows">
                                                        <div class='fancy-file' style="overflow:inherit !important;">
                                                            <div class='fancy-file-name'>&nbsp;</div>
                                                            <button class='fancy-file-button'>Browse...</button>
                                                            <div class='input-container'>
                                                                <?php echo $this->Form->input('Coach.photo',array('type'=>'file','class'=>'required','label'=>false,'div'=>false,'onchange'=>'readURL(this)')); ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
											</li>
											<li>
												 <div class="inputtype">
													<img id="img_prev" src="#" alt=""/>
												</div>
											</li>
										 </ul>
										 </div>
								
								<div class="clear"></div>
								
								<div class="leftColumns">	 
									<ul class="two-columns">
										<li> 
											<div class="blue">
												<button onclick="return submit_coachForm();">Send Invitation</button>
											</div>
										</li>
									</ul>
							  </div>
									  
									  
							</div> <!--left side box ends -->                                                               
						
						</div>
						<div class="clear"></div>								
								
							</div>
							
						</div><!--.left-column-->
												
						<?php echo $this->Form->end(); ?>					
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- MId Section End -->

<script type="text/javascript">

$(document).ready(function(e){
	$("#coach_options").autocomplete({
		 source: function( request, response ) {

        $.ajax({
            dataType: "json",
            type : 'Get',
            url: '<?php echo $this->webroot.'affiliate/get_users_for_coach'; ?>',
            data:
            {
                term: request.term,
            },
            success: function(data) {
            
				response( $.map( data, function(item) {
					 return {
						label: item.label,
						value: item.value,
						photo: item.photo
					}
				}));
           }		
					  
        });
      },
      select: function( event, ui ) {
				
				$('#selected_coach').val(ui.item.value);
				$('#coach_options').val(ui.item.label);
				return false;
			},
		 focus: function( event, ui ) {
				
				$('#selected_coach').val(ui.item.value);
				$('#coach_options').val(ui.item.label);
				return false;
			},	
		minLength: 1
	});
		
});

function submit_coachForm()
{
	$('#InviteCoachForm').validate({
            submitHandler: function(form) {                
                
                var frm = $('#InviteCoachForm').serialize();
                console.log(frm); 
                $('.custom_invitation_form').html('<div style="height:150px; text-align:center; "><img src="<?php echo $this->webroot.'images/loading.gif'; ?>" /></div>');
		
				$.post('<?php echo $this->webroot; ?>affiliate/invite_user',frm, function(data){
						
					$('.custom_invitation_form').html('<div style="height:150px; text-align:center; ">An invitation has been sent to user. You will be informed if he/she accepts your invitation for coach.</div>');	
				});
                
            }   
     });	
     
     return false;
}

function invite_user()
{
	var user_id = $('#selected_coach').val();
	var user = $('#coach_options').val();
	
	if( user=="" )
	{
		alert('Please select coach from GameOn');	
	} else {
		$('.invitation_form').html('<div style="height:150px; text-align:center; "><img src="<?php echo $this->webroot.'images/loading.gif'; ?>" /></div>');
		
		$.post('<?php echo $this->webroot; ?>affiliate/invite_new_user',frm, function(data){
				
			$('.invitation_form').html(data);	
			//$('.invitation_form').html('<div style="height:150px; text-align:center; ">An invitation has been sent to user. You will be informed if he/she accepts your invitation for coach.</div>');	
		});

	}	
	
	return false;
}


function readURL(input) {
	
	if (input.files[0] && input.files[0]) {
		var reader = new FileReader();

		reader.onload = function (e) {
			$('#img_prev').attr('src', e.target.result).width(70).height(70);
		};

		reader.readAsDataURL(input.files[0]);
	}
}

</script>

<?php 

App::uses('Controller', 'Controller');

/**
 * Info Controller
 *
 * Purpose : Manage info pages
 * @project Crossfot
 * @since 24 June, 2014
 * @version Cake Php 2.3.8
 * @author : Vivek Sharma
 */
class InfoController extends AppController 
{
	public $helpers = array('Html','Form','Js');
	public $uses = array('User','Event','Wod');
	
	public function beforeFilter()
	{
		parent::beforeFilter();
		$this->layout = 'default';
		$this->Auth->allow(array('search','search_event','search_athlete','search_affiliate'));
	}
	
	 /**
	 * Method Name : help	 
	 * Author Name : Vivek Sharma
	 * Date : 24 June 2014
	 * Description : show help popup 
	 */
	 public function help()
	 {
		$this->layout = 'ajax';
		$this->render('help');	
	 }
	 
	 /**
	 * Method Name : faq	 
	 * Author Name : Vivek Sharma
	 * Date : 24 June 2014
	 * Description : show faq 
	 */
	 public function faq()
	 {
		$this->loadModel('Faq');		
		
		$conditions = array();
		
		if ( !empty($this->request->data) )
		{
			if ( $this->data['faq_search_type'] == '1' )
			{	
				$conditions[] = array('Faq.question LIKE ' =>  "%".trim($this->data['faq_keyword'])."%");									
			} else if ( $this->data['faq_search_type'] == '2' )
			{
				$conditions[] = array('Faq.answer LIKE ' =>  "%".trim($this->data['faq_keyword'])."%");	
			} else {
				$conditions['OR'][] = array('Faq.question LIKE ' =>  "%".trim($this->data['faq_keyword'])."%");	
				$conditions['OR'][] = array('Faq.answer LIKE ' =>  "%".trim($this->data['faq_keyword'])."%");	
			}
			
			$this->set('faq_type', $this->data['faq_search_type']);
			$this->set('faq_keyword', $this->data['faq_keyword']);
		}
		
		$questions = $this->Faq->find('all', array('conditions' => $conditions));
		$this->set('questions', $questions);	
		$this->render('faq');	
	 }
	 
	 /**
	 * Method Name : tutorials	 
	 * Author Name : Vivek Sharma
	 * Date : 24 June 2014
	 * Description : show tutorials
	 */
	 public function tutorials()
	 {
	 	$this->loadModel('Tutorial');
		$this->render('tutorials');
	 }

	
	 /**
	 * Method Name : search	 
	 * Author Name : Vivek Sharma
	 * Date : 31 July 2014
	 * Description : search
	 */
	 public function search()
	 {
	 	if ( isset($this->request->query['key']) && !empty($this->request->query['key']) )
		{
			$key = $this->request->query['key'];
						
			$this->set(compact('key'));
			$this->render('search_results');
			
		}else{
			$this->redirect('/');
		}
	 }


	public function search_affiliate()
	{
		$key = $this->data['key'];
		if ( !empty($key) )
		{
			$this->layout = 'ajax';
			
			/*Search affiliates*/
			$this->paginate = array(
									'conditions' => array(
														'OR' => array(
																'User.first_name LIKE ' => '%'.$key.'%',
																'User.last_name LIKE ' => '%'.$key.'%',										
																'User.username LIKE ' => '%'.$key.'%',
																'User.email LIKE ' => '%'.$key.'%'
														),																		
														'User.status' => '1',
														'User.user_type' => 'affiliate'	
													),
									'fields' => array('User.first_name', 'User.last_name','User.photo','User.username', 'User.profile_description', 'User.id'),
									'limit' => '5'
									
									
									
						);
						
			$affiliates = $this->paginate('User');
			
			$this->set('data', $this->data);
			$this->set('affiliates', $affiliates);
			$this->render('search_affiliates');
		}
	}
	
	public function search_athlete()
	{
		$key = $this->data['key'];
		if ( !empty($key) )
		{
			$this->layout = 'ajax';
			
			/*Search affiliates*/
			$this->paginate = array(
									'conditions' => array(
														'OR' => array(
																'User.first_name LIKE ' => '%'.$key.'%',
																'User.last_name LIKE ' => '%'.$key.'%',										
																'User.username LIKE ' => '%'.$key.'%',
																'User.email LIKE ' => '%'.$key.'%'
														),																		
														'User.status' => '1',
														'User.user_type' => 'athlete'	
													),
									'fields' => array('User.first_name', 'User.last_name','User.photo','User.username', 'User.profile_description', 'User.id'),
									'limit' => '5'
									
									
									
						);
						
			$athletes = $this->paginate('User');
			
			$this->set('data', $this->data);
			$this->set('athletes', $athletes);
			$this->render('search_athletes');
		}
	}
	
	public function search_event()
	{
		$key = $this->data['key'];
		if ( !empty($key) )
		{
			$this->layout = 'ajax';
			
			/*Search events*/
			$this->paginate = array(
									'conditions' => array(
														'OR' => array(
																'Event.title LIKE ' => '%'.$key.'%',
																'Event.location LIKE ' => '%'.$key.'%',										
																
														),																		
														'Event.status' => '1'																				
													),
									'fields' => array('Event.title', 'Event.picture','Event.location','Event.event_type', 'Event.details', 'Event.id'),
									'limit' => '5'
									
						);
						
			$events = $this->paginate('Event');
			
			$this->set('data', $this->data);
			$this->set('events', $events);
			$this->render('search_events');
		}
	}
	
		
}
	
<?php
	echo $this->Html->script(array('jquery-ui.custom','ckeditor/ckeditor','https://maps.google.com/maps/api/js?libraries=places&language=en&sensor=true')); 
	echo $this->Html->css(array('jquery-ui.custom')); 
?>
<style>
	#errorMessage { margin-bottom: 0;}
</style>

	<!-- MId Section -->
	<section class="body-content-bg ptb25 row">
		<div class="page-mid">
			<div class="body-content-mn row mt10">
				<div class="row">
					<div class="register-columns">
						<?php 
							echo $this->Form->create('User',array('id'=>'UserProfileForm','class'=>'border-btm manageProfile')); 
							
							echo $this->Form->input('User.id',array('type' => 'hidden', 'value' => $user['User']['id']));
							echo $this->Form->input('AthleteProfile.id',array('type' => 'hidden','value'=>$athlete_profile_id));
							echo $this->Form->input('AthleteProfile.user_id',array('type' => 'hidden', 'value' => $user['User']['id']));
						?>
						<?php echo $this->Form->input('AthleteProfile.latitude',array('type' => 'hidden', 'class' => "MapLat"));?>
						<?php echo $this->Form->input('AthleteProfile.longitude',array('type' => 'hidden', 'class' => "MapLon"));?>
						<div class="column">
							<div class="header">
								<h3>Manage Profile </h3>
								<div class="blue save-btn">								
                                  <?php echo $this->Form->submit('Save',array('id'=>'save_profile','class'=>'save_event')); ?>  
								</div>								  
								
							</div>
							<?php 
								echo $this->Session->flash('success');
								echo $this->Session->flash('error');
								echo $this->Session->flash();
							?>
							<div class="column-body graybg create-event" style="padding-bottom:0px;">
								<div class="form-container no-lmr">							
                                    <div class="container">
										<div class="inlineRow">
											<div class="leftColumns">	
												<ul class="two-columns">
													<li>
														<?php echo $this->Form->label('User.first_name','First Name'); 
															echo $this->Form->input('User.first_name',array('type'=>'text', 'value' => $user['User']['first_name'], 'class'=>'required','label'=>false,'div'=>false)); 
														?>											
													</li>
													<li>
														<?php echo $this->Form->label('User.last_name','Last Name'); 
															echo $this->Form->input('User.last_name',array('type'=>'text', 'value' => $user['User']['last_name'], 'class'=>'required','label'=>false,'div'=>false)); 
														?>											
													</li>
												</ul>
												
												<div class="clear"></div>
	
												<ul class="two-columns">
													<li>
													<?php echo $this->Form->label('User.username','Username'); 
															echo $this->Form->input('User.username',array('type'=>'text', 'value' => $user['User']['username'], 'class'=>'required','label'=>false,'div'=>false)); 
														?>
												</li>
												<li>
													<?php echo $this->Form->label('User.photo','Photo'); ?>												
													<div class="inputbrows">
														<div class='fancy-file' style="overflow:inherit !important;">
															<div class='fancy-file-name'>&nbsp;</div>
															<button class='fancy-file-button'>Browse...</button>
															<div class='input-container'>
																<?php echo $this->Form->input('User.photo',array('type'=>'file','value'=>$user['User']['photo'],'class'=>'','label'=>false,'div'=>false,'onchange'=>'readURL(this)')); ?>
															</div>
														</div>
													</div>
												</li>
											</ul>
												
												<div class="clear"></div>
	
												<ul class="two-columns">
													<li>&nbsp;								
												</li>
												<li>
													<div class="inputtype">
														<img id="img_prev" src="<?php echo $this->webroot.'files/'.$user['User']['id'].'/thumb_'.$user['User']['photo']; ?>" alt="" height="70" width="70" style="height:70px;" />
													</div>
												</li>
											</ul>
										</div>
	
											<div class="leftColumns">	
												<ul class="two-columns clear-after">
													<li class="full">
													<?php echo $this->Form->label('User.profile_description','Description'); 
															echo $this->Form->input('User.profile_description',array('type'=>'textarea','value'=>$user['User']['profile_description'],'class'=>'ckeditor text-area','div'=>false,'label'=>false));	
														?>												
													</li>
												</ul>
											</div>
											<div class="clear"></div>
										</div>

										<div class="inlineRow">
											<div class="leftColumns">
												<ul class="two-columns">
													<li>
														<?php echo $this->Form->label('AthleteProfile.fb_page','Facebook Page ID'); 
															echo $this->Form->input('AthleteProfile.fb_page',array('type'=>'text','class'=>'','label'=>false,'div'=>false)); 
														?>											
													</li>
													<li>
														<?php
															echo $this->Form->label('AthleteProfile.twitter_page','Twitter Page ID'); 
															echo $this->Form->input('AthleteProfile.twitter_page',array('type'=>'text','class'=>'','label'=>false,'div'=>false)); 
														?>											
													</li>
												</ul>
												<div class="clear"></div>
		
												<ul class="two-columns clear-after">
													<li>
														<?php
															echo $this->Form->label('AthleteProfile.region_id','Region'); 
															echo $this->Form->input('AthleteProfile.region_id',array('type'=>'select','empty' => 'Select Region','options'=>$regions,'class'=>'','div'=>false,'label'=>false));	
														?>
													</li>
													<li class="with-calendar">
														<?php echo $this->Form->label('AthleteProfile.google_page','Google Page'); 
															echo $this->Form->input('AthleteProfile.google_page',array('type'=>'text','class'=>'url','label'=>false,'div'=>false)); 
														?>	
													</li>
												</ul>
												
													<ul class="two-columns">
													<li>
														<?php
															echo $this->Form->label('AthleteProfile.gender','Gender'); 
															echo $this->Form->input('AthleteProfile.gender',array('type'=>'select','empty' => 'Select Gender','options'=>array('Male' => 'Male', 'Female' => 'Female'),'class'=>'','div'=>false,'label'=>false));	
														?>										
													</li>
													<li class="with-calendar">
														<?php echo $this->Form->label('AthleteProfile.date_of_birth','Date of birth'); 
															echo $this->Form->input('AthleteProfile.date_of_birth',array('type'=>'text','class'=>'datepick','label'=>false,'div'=>false)); 
														?>											
													</li>
												</ul>
												<div class="clear"></div>
		
												<ul class="two-columns">
													<li>
														<?php echo $this->Form->label('AthleteProfile.height','Height'); 
															echo $this->Form->input('AthleteProfile.height',array('type'=>'text','class'=>'','label'=>false,'div'=>false)); 
														?>											
													</li>
													<li>
														<?php echo $this->Form->label('AthleteProfile.weight','Weight'); 
															echo $this->Form->input('AthleteProfile.weight',array('type'=>'text','class'=>'','label'=>false,'div'=>false)); 
														?>
													</li>
												</ul>
											</div> <!--left column ends here-->

											<div class="leftColumns">		
												<ul class="">
													<li>
														<?php echo $this->Form->label('AthleteProfile.address','Address'); 
															echo $this->Form->input('AthleteProfile.address',array('type'=>'text','id' => 'searchAddress','class'=>'','label'=>false,'div'=>false)); 
														?>		
														<div id="map_canvas" style="height: 350px;width: 400px;margin: 0.6em;"></div>									
													</li>
												
												</ul>
											</div> <!--left column ends here-->
											<div class="clear"></div>
										</div>

										
											
											<div class="clear"></div>
									
									</div> <!--container box ends -->
								</div>
								<div class="clear"></div>
							</div>
						</div><!--.left-column-->
						<?php echo $this->Form->end(); ?>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- MId Section End -->
<script type="text/javascript">
$(document).ready(function(){
	$('.datepick').datepicker({ dateFormat:"yy-mm-dd", changeYear:true, changeMonth: true, maxDate: 0, yearRange: '-50' });
});

CKEDITOR.replace( 'UserProfileDescription' ,
	{
		toolbar: [
			{ name: 'document', items: [ 'Source', '-', 'NewPage', 'Preview', '-', 'Templates' ] },	// Defines toolbar group with name (used to create voice label) and items in 3 subgroups.
			[ 'Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo' ],			// Defines toolbar group without name.
			'/',																					// Line break - next group will be placed in new line.
			{ name: 'basicstyles', items: [ 'Bold', 'Italic' ] }
		]
	});
	
function readURL(input) {
	
	if (input.files[0] && input.files[0]) {
		var reader = new FileReader();

		reader.onload = function (e) {
			$('#img_prev').attr('src', e.target.result).width(70).height(70);
		};

		reader.readAsDataURL(input.files[0]);
	}
}	


$(function () {
    var lat = <?php echo !empty($this->data['Admin']['latitude'])?$this->data['Admin']['latitude']:'44.88623409320778'; //44.88623409320778 ?>,
        lng = <?php echo !empty($this->data['Admin']['longitude'])?$this->data['Admin']['longitude']:'-87.86480712897173'; //-87.86480712897173 ?>,
        latlng = new google.maps.LatLng(lat, lng),
        image = 'https://www.google.com/intl/en_us/mapfiles/ms/micons/blue-dot.png';

    //zoomControl: true,
    //zoomControlOptions: google.maps.ZoomControlStyle.LARGE,

    var mapOptions = {
        center: new google.maps.LatLng(lat, lng),
        zoom: 13,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        panControl: true,
        panControlOptions: {
            position: google.maps.ControlPosition.TOP_RIGHT
        },
        zoomControl: true,
        zoomControlOptions: {
            style: google.maps.ZoomControlStyle.LARGE,
            position: google.maps.ControlPosition.TOP_left
        }
    },
    map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions),
        marker = new google.maps.Marker({
            position: latlng,
            map: map,
            icon: image
        });

    var input = document.getElementById('searchAddress');
    var autocomplete = new google.maps.places.Autocomplete(input, {
        types: ["geocode"]
    });

    autocomplete.bindTo('bounds', map);
    var infowindow = new google.maps.InfoWindow();

    google.maps.event.addListener(autocomplete, 'place_changed', function (event) {
        infowindow.close();
        var place = autocomplete.getPlace();
        if (place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport);
        } else {
            map.setCenter(place.geometry.location);
            map.setZoom(17);
        }

        moveMarker(place.name, place.geometry.location);
        $('.MapLat').val(place.geometry.location.lat());
        $('.MapLon').val(place.geometry.location.lng());
    });
    google.maps.event.addListener(map, 'click', function (event) {
        $('.MapLat').val(event.latLng.lat());
        $('.MapLon').val(event.latLng.lng());
        infowindow.close();
                var geocoder = new google.maps.Geocoder();
                geocoder.geocode({
                    "latLng":event.latLng
                }, function (results, status) {
                    console.log(results, status);
                    if (status == google.maps.GeocoderStatus.OK) {
                        console.log(results);
                        var lat = results[0].geometry.location.lat(),
                            lng = results[0].geometry.location.lng(),
                            placeName = results[0].address_components[0].long_name,
                            latlng = new google.maps.LatLng(lat, lng);

                        moveMarker(placeName, latlng);
                        $("#searchAddress").val(results[0].formatted_address);
                    }
                });
    });
   
    function moveMarker(placeName, latlng) {
        marker.setIcon(image);
        marker.setPosition(latlng);
        infowindow.setContent(placeName);
    }

    function initialize() { 
      var myOptions = {
          zoom: 14,
          center: new google.maps.LatLng(0.0, 0.0),
          mapTypeId: google.maps.MapTypeId.ROADMAP
        }
          map = new google.maps.Map(document.getElementById("map_canvas"),myOptions);
    }
});


</script>

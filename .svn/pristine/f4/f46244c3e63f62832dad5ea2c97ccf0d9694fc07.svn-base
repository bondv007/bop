<?php $this->Html->script(array('ckeditor/ckeditor'), array('inline'=>false));?>
	<div class="faqs row">
    <div class="floatleft mtop10"><h1><?php echo __('Edit WOD Dictionary'); ?></h1></div>
    <div class="floatright">
        <?php
		echo $this->Html->link('<span>'.__('Back To Manage WOD').'</span>', array('controller' => 'wods','action' => 'index','admin' => true),array('class'=>'black_btn','escape'=>false));?>
	</div>
	<div class="errorMsg"><?php echo $this->element('/admin/validations'); ?></div>
</div>

<div align="center" class="whitebox mtop15">
    <?php 
    echo $this->Form->create('Wod');
    echo $this->Form->hidden('id', array('type' => 'hidden'));
    ?>
    <table cellspacing="0" cellpadding="7" border="0" align="center">
		<tr>
			<td align="left"><strong class="upper">Title</strong></td>
			<td align="left"><?php	echo $this->Form->input('title',array('class' => 'input required', 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 450px;'));?>
			</td>
		</tr>
		<tr>
			<td align="left"><strong class="upper">Description</strong></td>
			<td align="left"><?php	echo $this->Form->input('description',array('class' => 'input required','type'=>'textarea', 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 450px;'));?>
			</td>
		</tr>
		<tr>
			<td align="left"><strong class="upper">Details</strong></td>
			<td align="left"><?php	echo $this->Form->input('details',array('class' => 'input required','type'=>'textarea', 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 450px;'));?>
			</td>
		</tr>
		<tr>
			<td align="left"><strong class="upper">WOD categories</strong></td>
			<td align="left"><?php	echo $this->Form->input('category_id',array('class' => 'input required','type'=>'select','options' => $categories, 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 450px;'));?>
			</td>
		</tr>
		<tr>
			<td align="left"><strong class="upper">WOD Type</strong></td>
			<td align="left"><?php	echo $this->Form->input('type_id',array('class' => 'input required','type'=>'select','options' => $types, 'empty' => 'please select', 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 450px;'));?>
			</td>
		</tr>
		<tr>
			<td align="left"><strong class="upper">WOD Subtype</strong></td>
			<td align="left"><?php	echo $this->Form->input('sub_type',array('class' => 'input','type'=>'select', 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 450px;'));?>
			</td>
		</tr>
		<tr>
			<td align="left"><strong class="upper">Number of rounds</strong></td>
			<td align="left"><?php	echo $this->Form->input('rounds',array('class' => 'input', 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 450px;'));?>
			</td>
		</tr>
		<tr>
			<td align="left"><strong class="upper">Result based on</strong></td>
			<td align="left">
				<?php	
				echo $this->Form->input('result_type', array(
						    'between' => '  ',
						    'separator' => ' ',
						    'type' => 'radio',
						    'options' => array('time' => 'Time', 'reps' => 'Reps','load' => 'Load','rounds' => 'Rounds','distance' => 'Distance'),
						    'value' => 'time',
						    'legend' => false
						));
				?>
			</td>
		</tr>
		<tr>
		<td colspan="2">
			<h2>Add Movements</h2>
			<div id="TextBoxesGroup">
				<?php
					if ( !empty($wod_movements) )
					{
						$i = 1;
						foreach ( $wod_movements as $movement )
						{
						?>
						<div id="TextBoxDiv<?php echo $i; ?>">
							<table>
								<tr>
									<td align="left"><strong class="upper">movements</strong></td>
									<td align="left"><?php	echo $this->Form->input('movement_category][',array('name' => "data[movement_category][]", 'type'=>'select', 'class' => 'input', 'options' => $movements, 'value' => $movement['WodMovement']['movement_id'], 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 450px;')); ?>
									</td>
								</tr>
								<tr>
									<td align="left"><strong class="upper">Options</strong></td>
									<td align="left"><?php
									
									echo $this->Form->input('movement_option][',array('name' => "data[movement_option][]",'type'=>'select', 'class' => 'input optionSelected', 'options' => array('distance' => 'Distance','load' => 'Load', 'reps' => 'Reps', 'none' => 'None'), 'value' => $movement['WodMovement']['type'] , 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 200px;'));
									echo $this->Form->input('option_data][]', array('name' => "data[option_data][]",'class' => 'input','label' => false,'div' => false,'placeholder' => 'value', 'value' => $movement['WodMovement']['value']) );
									if ( $movement['WodMovement']['type'] == 'distance')
									{
										echo $this->Form->input('movement_distance][',array('name' => "data[movement_distance][]",'type'=>'select', 'class' => 'input distanceOption', 'options' => array('mile' => 'Mile','meter' => 'Meter'), 'value' => $movement['WodMovement']['sub_type'] , 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 70px;'));
										echo $this->Form->input('movement_load][',array('name' => "data[movement_load][]",'type'=>'select', 'class' => 'input loadOption', 'options' => array('lbs' => 'lbs','kg' => 'Kg'),'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 70px;display:none;')); 
									}
									else if ( $movement['WodMovement']['type'] == 'load')
									{
										echo $this->Form->input('movement_load][',array('name' => "data[movement_load][]",'type'=>'select', 'class' => 'input loadOption', 'options' => array('lbs' => 'lbs','kg' => 'Kg'), 'value' => $movement['WodMovement']['sub_type'], 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 70px;')); 
										echo $this->Form->input('movement_distance][',array('name' => "data[movement_distance][]",'type'=>'select', 'class' => 'input distanceOption', 'options' => array('mile' => 'Mile','meter' => 'Meter'), 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 70px;display:none;'));
									}
									else
									{
										echo $this->Form->input('movement_load][',array('name' => "data[movement_load][]",'type'=>'select', 'class' => 'input loadOption', 'options' => array('lbs' => 'lbs','kg' => 'Kg'),'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 70px;display:none;')); 	
										echo $this->Form->input('movement_distance][',array('name' => "data[movement_distance][]",'type'=>'select', 'class' => 'input distanceOption', 'options' => array('mile' => 'Mile','meter' => 'Meter'), 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 70px;display:none;'));
									}								
									
									?>
									</td>
								</tr>
							</table>
						</div>
						<?php
						$i++;
						}
					}
				?>
			</div>	
			<input type='button' value='Add Movements' id='addButton'>&nbsp;
			<input type='button' value='Remove Movements' id='removeButton'>	
		</td>
        <tr>
            <td align="left"></td>
            <td align="left"><div class="black_btn2"><span class="upper"><?php echo $this->Form->end(__('Submit'));?></span></div></td>
        </tr>  
    </table>
</div>
<div id="movementsDataBoxHtml" style="display: none">
	<table>
		<tr>
			<td align="left"><strong class="upper">movements</strong></td>
			<td align="left"><?php	echo $this->Form->input('movement_category][',array('type'=>'select', 'class' => 'input', 'options' => $movements, 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 450px;')); ?>
			</td>
		</tr>
		<tr>
			<td align="left"><strong class="upper">Options</strong></td>
			<td align="left">
				<?php				
				echo $this->Form->input('movement_option][',array('type'=>'select', 'class' => 'input optionSelected', 'options' => array('distance' => 'Distance','load' => 'Load', 'reps' => 'Reps', 'none' => 'None') , 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 200px;'));
				echo $this->Form->input('option_data][]', array('class' => 'input','label' => false,'div' => false,'placeholder' => 'value') );
				echo $this->Form->input('movement_distance][',array('type'=>'select', 'class' => 'input distanceOption', 'options' => array('mile' => 'Mile','meter' => 'Meter'), 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 70px;'));
				echo $this->Form->input('movement_load][',array('type'=>'select', 'class' => 'input loadOption', 'options' => array('lbs' => 'lbs','kg' => 'Kg'), 'label' => false, 'error' => false, 'div' => false, 'style'=>'width: 70px;display:none;')); 
				?>
				
			</td>
		</tr>
	</table>
</div>
<?php
$this->Js->get('#WodTypeId')->event('change', 
	$this->Js->request(array(
		'controller'=>'movements',
		'action'=>'get_by_type'
		), array(
		'update'=>'#WodSubType',
		'async' => true,
		'method' => 'post',
		'dataExpression'=>true,
		'data'=> $this->Js->serializeForm(array(
			'isForm' => true,
			'inline' => true
			))
		))
	);
?>
<script type="text/javascript">
 
$(document).ready(function(){ 
    var counter = <?php echo count($wod_movements) + 1; ?>;
    $("#addButton").click(function () { 
	    var html = $("#movementsDataBoxHtml").html();
		$("#TextBoxesGroup").append('<div id="TextBoxDiv'+ counter +'">'+ html + '</div>');
		counter++;
     });
 
     $("#removeButton").click(function () {
		if(counter==1){
	          alert("No more textbox to remove");
	          return false;
	       } 	 
		counter--;	 
        $("#TextBoxDiv" + counter).remove();
     });
     $(".optionSelected").live('change',function(){
		var selectedOption = $(this).val();
		
		var parentId = $(this).parents('div').attr("id");
		
		if ( selectedOption == 'distance'){
			$('#' + parentId + ' .distanceOption').show();
			$('#' + parentId + ' .loadOption').hide();
		}else if ( selectedOption == 'load'){
			$('#' + parentId + ' .distanceOption').hide();
			$('#' + parentId + ' .loadOption').show();
		}else{
			$('#' + parentId + ' .distanceOption').hide();
			$('#' + parentId + ' .loadOption').hide();
		}
	});
     
  });
</script>
<script>

$(function(){ 
  $('#WodAdminEditForm').validate();
});

	CKEDITOR.replace( 'WodDescription' ,
	{
		toolbar: [
			{ name: 'document', items: [ 'Source', '-', 'NewPage', 'Preview', '-', 'Templates' ] },	// Defines toolbar group with name (used to create voice label) and items in 3 subgroups.
			[ 'Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo' ],			// Defines toolbar group without name.
			'/',																					// Line break - next group will be placed in new line.
			{ name: 'basicstyles', items: [ 'Bold', 'Italic' ] }
		]
	});
	CKEDITOR.replace( 'WodDetails' ,
	{
		toolbar: [
			{ name: 'document', items: [ 'Source', '-', 'NewPage', 'Preview', '-', 'Templates' ] },	// Defines toolbar group with name (used to create voice label) and items in 3 subgroups.
			[ 'Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo' ],			// Defines toolbar group without name.
			'/',																					// Line break - next group will be placed in new line.
			{ name: 'basicstyles', items: [ 'Bold', 'Italic' ] }
		]
	});
	
</script>
<?php
if (class_exists('JsHelper') && method_exists($this->Js, 'writeBuffer')) echo $this->Js->writeBuffer();
// Writes cached scripts
?>
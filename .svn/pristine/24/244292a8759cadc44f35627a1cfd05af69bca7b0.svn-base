<?php
 echo $this->Html->script('jquery-ui.custom'); 
 echo $this->Html->css(array('jquery-ui.custom')); 
 ?>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>

<style>
#map-canvas label.error{  display: block; margin-left: 225px; margin-top: 6px; position: absolute;}

.column-body.graybg.create-event input[type="text"], 
.column-body.graybg.create-event textarea, 
.column-body.graybg.create-event select, 
.column-body.graybg.create-event input[type="file"] {
	margin-bottom: 0;
}
</style> 


	<!-- MId Section -->
	<section class="body-content-bg ptb25 row">
		<div class="page-mid">
			<div class="body-content-mn row mt10">
				<div class="row">
					<div class="register-columns">
						<?php echo $this->Form->create('Event',array('type'=>'file','id'=>'CreateEventForm','class'=>'border-btm')); ?>
						<div class="column">
							
							<div class="header">
								<h3>CREATE EVENT </h3>
								<div class="blue save-btn">								
                                  <?php echo $this->Form->submit('Save',array('id'=>'save_event')); ?>  
								</div>								  
								
							</div>
							<?php 
								echo $this->Session->flash('success');
								echo $this->Session->flash('error');
								echo $this->Session->flash();
							?>
							<div class="column-body graybg create-event" style="padding-bottom:0px;">							

								<div class="form-container no-lmr">							
									
									<?php echo $this->Form->input('counter_pricing',array('type'=>'hidden','value'=>1)); ?>
                                    <div class="left-side-box">
										<ul class="two-columns">
											<li>
												<?php echo $this->Form->label('Event.title','Event Title'); 
													echo $this->Form->input('Event.title',array('type'=>'text','class'=>'required','label'=>false,'div'=>false)); 
												?>											
											</li>
											<li>
												<?php echo $this->Form->label('Event.picture','Event Picture'); ?>												
													<div class="inputbrows">
                                                        <div class='fancy-file' style="overflow:inherit !important;">
                                                            <div class='fancy-file-name'>&nbsp;</div>
                                                            <button class='fancy-file-button'>Browse...</button>
                                                            <div class='input-container'>
                                                                <?php echo $this->Form->input('Event.picture',array('type'=>'file','class'=>'required','label'=>false,'div'=>false,'onchange'=>'readURL(this)')); ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                     <div class="inputtype">
														<img id="img_prev" src="#" alt="" />
													</div>
											</li>
										</ul>
										<ul class="two-columns clear-after">
											<li class="full">
											<?php echo $this->Form->label('Event.details','Event Details'); 
													echo $this->Form->input('Event.details',array('type'=>'textarea','class'=>'text-area','div'=>false,'label'=>false));	
												?>												
											</li>
										</ul>
										<ul class="two-columns">
											<li class="full">
												<?php echo $this->Form->label('Event.notes','Notes'); 
													echo $this->Form->input('Event.notes',array('type'=>'textarea','class'=>'text-area','div'=>false,'label'=>false));	
												?>
											</li>
										</ul>
										<ul class="two-columns pricing price_box_1 clear-after">
											<li>
												<?php echo $this->Form->label('Eventprice.1.price','Pricing'); 
													echo $this->Form->input('Eventprice.1.price',array('type'=>'text','class'=>'required number','div'=>false,'label'=>false));	
												?>												
											</li>
											<li class="with-calendar">
												<?php echo $this->Form->label('Eventprice.1.date','Date'); 
													echo $this->Form->input('Eventprice.1.date',array('type'=>'text','class'=>'required datepick','div'=>false, 'readonly' => 'readonly','label'=>false));	
												?>	
											</li>			
											
										</ul>
										<ul class="two-columns no-tmr" style="padding-top:7px; padding-bottom:17px;">
										<li style="  float: right; margin-right: -123px;">
											<a href="javascript://" onclick="add_pricing_div();">Add more pricing</a>
											</li>
										</ul>
										
										
                                        </div> <!--left side box ends -->
                                        
                                        <!--right side map box-->
                                        <input type="hidden" name="data[Event][latitude]" id="latitude"/>
                                        <input type="hidden" name="data[Event][longitude]" id="longitude"/>
                                        <input type="text" placeholder="Type Location" id="location" name="data[Event][location]"  class="location required" />
                                        <div class="right-side-box map" id="map-canvas">
                                        	
                                        </div>
                                        <div class="clear"></div>
                                        <!--right side map box ends-->
                                       
                                      
                                        <section class="section-form-section" style="border-top: 1px solid #A6A6A6; margin-top: 11px;">
                                        <div class="clearfix"></div>
                                        <div style="margin-top:25px;">
										<ul style="vertical-align:top;">
											<li>
												<?php echo $this->Form->label('Event.event_type','Event Type'); 
													echo $this->Form->input('Event.event_type',array('type'=>'select','options'=>array('competition'=>'Competition','throwdown'=>'Throwdown','challenge'=>'Challenge','fundraiser'=>'Fundraiser'),'class'=>'required','div'=>false, 'onchange' => 'check_event_type(this.value)', 'label'=>false));	
												?>												
											</li>
											<li>
												<?php echo $this->Form->label('Event.mode','Public/Private'); 
													echo $this->Form->input('Event.mode',array('type'=>'select','options'=>array('public'=>'Public','private'=>'Private'),'class'=>'required','div'=>false,'label'=>false));	
												?>												
											</li>
										</ul>
										<ul class="middle" id="duration_div" style="vertical-align:top; margin-top:0px;">
											<li>
												<?php 
													$days_options = array();
													for( $j=1; $j<31; $j++ )
													{
														$days_options[$j]=$j;
													}
													echo $this->Form->label('Event.duration','Duration'); 
													echo $this->Form->input('Event.duration_type',array('type'=>'select','options'=>array('days'=>'Days','weeks'=>'Weeks','months'=>'Months'),'class'=>'required','div'=>false,'label'=>false));	
													echo $this->Form->input('Event.duration',array('type'=>'select','options'=>$days_options,'div'=>false,'class'=>'required','label'=>false,'class'=>'too-small'));	
												?>											
											</li>
										</ul>
										<ul class="date-time" style="vertical-align:top; margin-top:0px;">
											<li>
												<?php echo $this->Form->label('Event.start_date','Date'); 
													  echo $this->Form->input('Event.start_date',array('type'=>'text','class'=>'required datepick', 'readonly' => 'readonly','label'=>false,'div'=>false)); 
												?>
											</li>
											<li>
												<?php echo $this->Form->label('Event.start_time','Time'); 
													  echo $this->Form->input('Event.start_time',array('type'=>'time','class'=>'required','label'=>false,'div'=>false)); 
												?>
											</li>
										</ul>
										</div>
                                        <input type="button" class="gray-btn mb20" onclick="invite_athlete_popup();" value="Invite atheletes/affiliates /teams etc " style="margin-top:30px; margin-bottom:5px !important;"/>
                                        <div class="clear"></div>
                                        
                                        <input type = "hidden" id = "number_invited_people" value = "0" />
                                        <div class="invited_people_div"></div>	 
                                        <div class="border-btm">
										<label style="display:none;" id="invitee_label">Invitees: </label>
                                        <ul class="display_people" style="margin-top:5px; width:100%; max-width:100%">	
                                        					
										</ul>                                                                  
										</div>
                                        <div class="clear"></div>                                  
										
										</section>                            
                                    
								</div>
								<div class="clear"></div>
							</div>
							
						</div><!--.left-column-->

						<div class="column">
							<div class="column-body graybg create-event" style="padding-top:3px;">
								<div class="form-container no-lmr">
									<section class="section-form-section division_section" style="padding-bottom:15px;">
										
                                        <div class="clearfix"></div>
                                        <input type="hidden" id="division_count" value="0"/>
										<ul>
											<li>
												<label>Divisions	</label>
                                                <select class="medium" id="division"> 
                                                    <option value='Male open'> Male open</option>
                                                    <option value='Female open'> Female open</option>
                                                    <option value='Male masters'> Male masters</option>
                                                    <option value='Female masters'> Female masters</option>
                                                </select>
											</li>
											<li>
												<label>  Sex	</label>
                                                <select class="medium" id='division_sex'> 
                                                    <option value='Male'> Male </option>
                                                    <option value='Female'> Female</option>
                                                    
                                                </select>
											</li>
										</ul>
										<ul class="middle">
											<li>
												<label> Number of Wods	</label>
                                                <select class="small" id='number_of_wods'> 
                                                    <?php for( $k=1; $k < 11; $k++){ ?>
                                                    <option value='<?php echo $k; ?>'><?php echo $k; ?></option>
                                                    <?php } ?>
                                                </select>
											</li>
										</ul>
										<ul class="middle right-list">
                                        	<li>
                                            	
                                        <input type="button" class="gray-btn mt25" value="Add New Division" onclick="add_division();"/>
                                            </li>
                                        </ul>
									
									</section>
								</div>
								<div class="clear"></div>
							</div>
						</div>
						
						<?php echo $this->Form->end(); ?>					
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- MId Section End -->

<?php 
	echo $this->element('custom_wod_popup'); 
	echo $this->element('invite_athlete_popup'); 
?>
	
<script type="text/javascript">

$(document).ready(function(){
	
	google.maps.event.addDomListener(window, 'load', initialize('location', 'map-canvas'));
	$('#EventCounterPricing').val(1);
	$('.datepick').datepicker({ minDate: 0, dateFormat:"yy-mm-dd" });
	$('#division_count').val(1);
	$('#number_of_wods').val(1);
	$('#EventEventType').val("challenge");
	
	//add_division();
	
});


function check_event_type(value)
{
	if(value == "challenge") 
	{
		$('#duration_div').show();
	}else{
		$('#duration_div').hide();
	}	
}

function add_pricing_div()
{
	var num = $('#EventCounterPricing').val();
	num = parseInt(num) + 1;
	$('ul.pricing:last').after('<ul class="two-columns pricing price_box_'+num+' clear-after"><li><label for="Eventprice'+num+'Price">Pricing</label><input type="text" id="Eventprice'+num+'Price" class="required number" name="data[Eventprice]['+num+'][price]"></li><li class="with-calendar"><label for="Eventprice'+num+'Date">Date</label><input type="text" id="Eventprice'+num+'Date" class="required datepick" name="data[Eventprice]['+num+'][date]" readonly="readonly"> <a href="javascript://" onclick="remove_pricing_div('+num+')"> &nbsp; </a></a></li></ul>');
	$('#EventCounterPricing').val(num);
	$('.datepick').datepicker({ minDate: 0, dateFormat:"yy-mm-dd" });
}

function remove_pricing_div(num)
{
	$('.price_box_'+num).remove();	
}

function add_division()
{
	var event_id = $('#event_id').val();
	var division = $('#division').val();
	var division_sex = $('#division_sex').val();
	var num_wods = $('#number_of_wods').val();
	var div_count = $('#division_count').val();
	
	$.post('<?php echo $this->webroot; ?>events/add_division',{ division:division, division_sex: division_sex, num_wods: num_wods, div_count: div_count}, function(data) {
		$('.division_section').after(data);
		$('#division_count').val(parseInt(div_count)+1);
		scrollToAnchor('.new_division_' + (parseInt(div_count)+1));
	});	
}

function readURL(input) {
	
	if (input.files[0] && input.files[0]) {
		var reader = new FileReader();

		reader.onload = function (e) {
			$('#img_prev').attr('src', e.target.result).width(70).height(70);
		};

		reader.readAsDataURL(input.files[0]);
	}
}

function invite_athlete_popup()
{
	var top = $('#map-canvas').offset().top;
	$('.loginBox').css('margin-top',top + 'px');
	$('.invite_athlete_box').fadeIn();
	get_people();
	//scrollToAnchor('.invite_athlete_box');
}

function get_people()
{
	$.post('<?php echo $this->webroot; ?>events/get_people',function(data){
		$('.people_div').html(data);
		$('.loading_div').hide();	
	});	
}

</script>	
